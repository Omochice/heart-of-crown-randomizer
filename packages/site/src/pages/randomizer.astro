---
import { rules } from "../rules/index";
---

<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title></title>
  </head>
  <body>
    <h1>Randomizer</h1>
    <form
      action="#"
      id="option-form"
    >
      {
        rules.map((r) => (
          <div>
            <input type="checkbox" />
            <label>{r.description}</label>
          </div>
        ))
      }
      <button>ランダマイズ</button>
    </form>
    <div id="result"></div>
    <script>
      import { Basic, FarEasternBorder } from "@heart-of-crown-randomizer/card";
      function randint(max: number): number {
        return Math.floor(Math.random() * Math.floor(max));
      }
      const cards = [...Basic.commons, ...FarEasternBorder.commons];

      function getRandomCards() {
        const cardIndexes = new Set<number>();
        while (cardIndexes.size < 10) {
          cardIndexes.add(randint(cards.length));
        }
        return Array.from(cardIndexes).map((index) => cards[index]);
      }

      function clearChild(element: HTMLElement): void {
        while (element.firstChild) {
          element.removeChild(element.firstChild);
        }
      }

      document
        .querySelector("#option-form")
        ?.addEventListener("submit", (e: Event) => {
          e.preventDefault();
          const result = document.getElementById("result");
          if (result == null) {
            console.error("button is not found");
            return;
          }
          clearChild(result);
          const cards = getRandomCards();
          for (const card of cards) {
            const cardWrapper = document.createElement("div");
            const anchor = document.createElement("a");
            anchor.href = `../cards/${card!.id}`;
            anchor.textContent = card!.name;
            cardWrapper.appendChild(anchor);
            result.appendChild(cardWrapper);
          }
        });
    </script>
  </body>
</html>
